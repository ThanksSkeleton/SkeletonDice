<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GreenDice</title>
  <style>
    #counter {
      display: inline-block;
      transform-origin: center center;
      transform: scale(1);
      transition: transform 0.2s ease;
    }
    #counter.bump {
      transform: scale(1.3);
    }
  </style>
</head>
<body>
  <h1 id="counter"></h1>

  <div id="buttons">
    <button data-dice="1" data-sides="4">1d4</button>
    <button data-dice="1" data-sides="6">1d6</button>
    <button data-dice="2" data-sides="6">2d6</button> <!-- NEW -->
    <button data-dice="1" data-sides="8">1d8</button>
    <button data-dice="1" data-sides="10">1d10</button>
    <button data-dice="1" data-sides="12">1d12</button>
    <button data-dice="1" data-sides="20">1d20</button>
    <button data-dice="1" data-sides="100">1d100</button>
    <button id="clear">Clear</button>
    <button id="settingsBtn">Settings</button>
  </div>

  <dialog id="settingsModal">
    <h2>Settings</h2>

    <fieldset>
      <legend>Background Color</legend>
      <label><input type="radio" name="bgColor" value="green"> Green Screen</label><br>
      <label><input type="radio" name="bgColor" value="magenta"> Magenta Screen</label><br>
      <label><input type="radio" name="bgColor" value="custom"> Custom HEX:</label>
      <input type="text" id="customHex" placeholder="#00FF00" maxlength="7">
    </fieldset>

    <fieldset>
      <legend>Reroll Behavior</legend>
      <label><input type="radio" name="rerollMode" value="RESET"> Reset</label><br>
      <label><input type="radio" name="rerollMode" value="ADD"> Add</label>
    </fieldset>

    <button id="saveSettings">Save</button>
    <button id="closeSettings">Cancel</button>
  </dialog>

  <script>
    const counter = document.getElementById('counter');
    const buttons = document.querySelectorAll('button[data-sides]');
    const clearBtn = document.getElementById('clear');
    const settingsBtn = document.getElementById('settingsBtn');
    const modal = document.getElementById('settingsModal');
    const saveBtn = document.getElementById('saveSettings');
    const closeBtn = document.getElementById('closeSettings');

    const defaultSettings = {
      bgColor: 'green',
      customHex: '#00FF00',
      rerollMode: 'RESET'
    };

    let settings = loadSettings();

    function loadSettings() {
      const stored = localStorage.getItem('skeletondice-settings');
      const parsed = stored ? JSON.parse(stored) : defaultSettings;
      applySettings(parsed);
      return parsed;
    }

    function saveSettings() {
      localStorage.setItem('skeletondice-settings', JSON.stringify(settings));
    }

    function applySettings(s) {
      if (s.bgColor === 'custom') {
        document.body.style.backgroundColor = s.customHex || '#00FF00';
      } else if (s.bgColor === 'green') {
        document.body.style.backgroundColor = '#00FF00';
      } else if (s.bgColor === 'magenta') {
        document.body.style.backgroundColor = '#FF00FF';
      }
    }

    function rollDie(sides) {
      return Math.floor(Math.random() * sides) + 1;
    }

    // --- NEW: generalized roll for multiple dice ---
    function rollDice(count, sides) {
      let total = 0;
      for (let i = 0; i < count; i++) {
        total += rollDie(sides);
      }
      return total;
    }

    function getCurrentValue() {
      const val = parseInt(counter.textContent);
      return isNaN(val) ? 0 : val;
    }

    function animateRoll() {
      counter.classList.add('bump');
      setTimeout(() => counter.classList.remove('bump'), 200);
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const sides = parseInt(btn.dataset.sides);
        const count = parseInt(btn.dataset.dice || "1"); 
        const roll = rollDice(count, sides);             

        if (settings.rerollMode === "RESET") {
          counter.textContent = roll;
        } else if (settings.rerollMode === "ADD") {
          const current = getCurrentValue();
          counter.textContent = current + roll;
        }

        animateRoll();
      });
    });

    clearBtn.addEventListener('click', () => {
      counter.textContent = '';
    });

    settingsBtn.addEventListener('click', () => {
      document.querySelector(`input[name="bgColor"][value="${settings.bgColor}"]`).checked = true;
      document.getElementById('customHex').value = settings.customHex || '';
      document.querySelector(`input[name="rerollMode"][value="${settings.rerollMode}"]`).checked = true;
      modal.showModal();
    });

    saveBtn.addEventListener('click', () => {
      const bgColor = document.querySelector('input[name="bgColor"]:checked').value;
      const customHex = document.getElementById('customHex').value.trim();
      const rerollMode = document.querySelector('input[name="rerollMode"]:checked').value;

      settings = { bgColor, customHex, rerollMode };
      saveSettings();
      applySettings(settings);
      modal.close();
    });

    closeBtn.addEventListener('click', () => modal.close());
  </script>
</body>
</html>